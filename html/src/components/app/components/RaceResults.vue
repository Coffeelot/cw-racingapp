<template>
  <div class="results-container page-container">
    <div class="inline standardGap header">
      <v-select
        color="primary"
        density="compact"
        hide-details
        :items="Object.values(props.allResults)"
        return-object
        item-title="Data.RaceData.RaceName"
        v-model="selectedRace"
        :placeholder="translate('select_track')"
        class="w-50"
      ></v-select>
    </div>
    <div v-if="!selectedRace">
      <InfoText :title="translate('select_track_to_view')"></InfoText>
    </div>
    <div v-else >
      <v-table v-if="selectedRace.Result.length>0">
        <thead>
          <tr>
            <th class="text-left">
            </th>
            <th class="text-left">
              {{translate('rank')}}
            </th>
            <th class="text-left">
              {{ translate('time') }}
            </th>
            <th class="text-left">
              {{  translate('best_lap') }}
            </th>
            <th class="text-left">
              {{ translate('vehicle') }}
            </th>
            <th class="text-left">
              {{  translate('class') }}
            </th>
            <th class="text-left" v-if="selectedRace.Data.RaceData.Ranked">
              {{ translate('rank_change') }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr
            v-for="(item, index) in sortedResults"
            :key="item.RacerName"
          >
            <td> {{ index +1 }}. {{ item.RacerName }} {{ item.RacingCrew ? '[' + item.RacingCrew + ']' : '' }}</td>
            <td>{{ item.Ranking }}</td>
            <td>{{ msToHMS(item.TotalTime) }}</td>
            <td>{{ msToHMS(item.BestLap) }}</td>
            <td>{{ item.VehicleModel }}</td>
            <td>{{ item.CarClass }}</td>
            <td  v-if="selectedRace.Data.RaceData.Ranked">{{ item.TotalChange}}</td>
          </tr>
        </tbody>
      </v-table>
      <div v-else>
        <InfoText :title="translate('no_data')"></InfoText>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ResultData } from "@/store/types";
import { computed, Ref, ref } from "vue";
import InfoText from "./InfoText.vue";
import { msToHMS } from "@/helpers/msToHMS";
import { translate } from "@/helpers/translate";

const props = defineProps<{
  allResults: ResultData[];
}>();


const selectedRace: Ref<ResultData | undefined> = ref(undefined)
const sortedResults = computed(() => {
  if (!selectedRace.value) return undefined
  const result = selectedRace.value.Result
  return result.sort((res1, res2) => res1.TotalTime < res2.TotalTime ? -1 : 1 )
})
</script>

<style scoped lang="scss">
.header{
  margin-bottom: 1em;
}
</style>
